"""
API Routes - Generated by Dev-conditional
"""

from fastapi import APIRouter, Depends, HTTPException, status
from sqlalchemy.orm import Session
from typing import List, Optional
{% if models %}
from .models import {{ models | map(attribute='name') | join(', ') }}
from .schemas import (
{% for model in models %}
    {{ model.name }}Create, {{ model.name }}Update, {{ model.name }} as {{ model.name | lower }}_schema,
{% endfor %}
    MessageResponse
)
{% endif %}
from .database import get_db
import logging

logger = logging.getLogger(__name__)
router = APIRouter()

{% for model in models %}
# {{ model.name | capitalize }} routes
@router.get("/{{ model.name | lower }}s/", response_model=List[{{ model.name | lower }}_schema])
async def get_{{ model.name | lower }}s(
    skip: int = 0,
    limit: int = 100,
    db: Session = Depends(get_db)
):
    """Get all {{ model.name | lower }}s"""
    {{ model.name | lower }}s = db.query({{ model.name }}).offset(skip).limit(limit).all()
    return {{ model.name | lower }}s

@router.get("/{{ model.name | lower }}s/{{ '{' }}{{ model.name | lower }}_id{{ '}' }}", response_model={{ model.name | lower }}_schema)
async def get_{{ model.name | lower }}(
    {{ model.name | lower }}_id: int,
    db: Session = Depends(get_db)
):
    """Get a specific {{ model.name | lower }}"""
    {{ model.name | lower }} = db.query({{ model.name }}).filter({{ model.name }}.id == {{ model.name | lower }}_id).first()
    if not {{ model.name | lower }}:
        raise HTTPException(
            status_code=status.HTTP_404_NOT_FOUND,
            detail="{{ model.name | capitalize }} not found"
        )
    return {{ model.name | lower }}

@router.post("/{{ model.name | lower }}s/", response_model={{ model.name | lower }}_schema)
async def create_{{ model.name | lower }}(
    {{ model.name | lower }}: {{ model.name }}Create,
    db: Session = Depends(get_db)
):
    """Create a new {{ model.name | lower }}"""
    db_{{ model.name | lower }} = {{ model.name }}(**{{ model.name | lower }}.model_dump())
    db.add(db_{{ model.name | lower }})
    db.commit()
    db.refresh(db_{{ model.name | lower }})
    return db_{{ model.name | lower }}

@router.put("/{{ model.name | lower }}s/{{ '{' }}{{ model.name | lower }}_id{{ '}' }}", response_model={{ model.name | lower }}_schema)
async def update_{{ model.name | lower }}(
    {{ model.name | lower }}_id: int,
    {{ model.name | lower }}_update: {{ model.name }}Update,
    db: Session = Depends(get_db)
):
    """Update a {{ model.name | lower }}"""
    db_{{ model.name | lower }} = db.query({{ model.name }}).filter({{ model.name }}.id == {{ model.name | lower }}_id).first()
    if not db_{{ model.name | lower }}:
        raise HTTPException(
            status_code=status.HTTP_404_NOT_FOUND,
            detail="{{ model.name | capitalize }} not found"
        )

    for field, value in {{ model.name | lower }}_update.model_dump(exclude_unset=True).items():
        setattr(db_{{ model.name | lower }}, field, value)

    db.commit()
    db.refresh(db_{{ model.name | lower }})
    return db_{{ model.name | lower }}

@router.delete("/{{ model.name | lower }}s/{{ '{' }}{{ model.name | lower }}_id{{ '}' }}")
async def delete_{{ model.name | lower }}(
    {{ model.name | lower }}_id: int,
    db: Session = Depends(get_db)
):
    """Delete a {{ model.name | lower }}"""
    db_{{ model.name | lower }} = db.query({{ model.name }}).filter({{ model.name }}.id == {{ model.name | lower }}_id).first()
    if not db_{{ model.name | lower }}:
        raise HTTPException(
            status_code=status.HTTP_404_NOT_FOUND,
            detail="{{ model.name | capitalize }} not found"
        )

    db.delete(db_{{ model.name | lower }})
    db.commit()
    return {"message": "{{ model.name | capitalize }} deleted successfully"}

{% endfor %}

# Custom endpoints from workflow
{% for endpoint in endpoints %}
@router.{{ endpoint.method.lower() }}("{{ endpoint.path }}")
async def {{ endpoint.function_name }}():
    """{{ endpoint.description }}"""
    # TODO: Implement {{ endpoint.function_name }}
    return {"message": "{{ endpoint.function_name }} - TODO: Implement this endpoint"}

{% endfor %}