<div class="card shadow mb-4" id="spectrum-sim-panel">
    <div class="card-header py-3 bg-gradient-dark text-white d-flex align-items-center justify-content-between">
        <h6 class="m-0 font-weight-bold"><i class="fas fa-microscope"></i> Embedded Spectrum Simulator</h6>
        <div>
            <span class="badge badge-primary">2D Slice Analysis</span>
        </div>
    </div>
    <div class="card-body">
        <div class="row">
            <div class="col-md-8">
                <div class="canvas-container"
                    style="background: #000; padding: 10px; border-radius: 4px; text-align: center;">
                    <canvas id="spectrum-canvas" width="400" height="300"
                        style="max-width: 100%; border: 1px solid #444;"></canvas>
                </div>
            </div>
            <div class="col-md-4">
                <h5>Spectrum Config ðŸŒˆ</h5>
                <div class="form-group">
                    <label>Cold (Safe) Hex:</label>
                    <input type="color" id="hex-cold" class="form-control" value="#0000ff"
                        onchange="renderSimulation()">
                </div>
                <div class="form-group">
                    <label>Hot (DANGER) Hex:</label>
                    <input type="color" id="hex-hot" class="form-control" value="#ff0000" onchange="renderSimulation()">
                </div>
                <hr>
                <div class="metrics-small">
                    <div>Max Stress: <span id="val-stress" class="text-danger">150 MPa</span></div>
                    <div>Safety Factor: <span id="val-sf" class="text-success">2.4</span></div>
                </div>
                <button class="btn btn-block btn-outline-primary mt-3" onclick="randomizeData()">Generate Random
                    Data</button>
            </div>
        </div>
    </div>
</div>

<script>
    const canvas = document.getElementById('spectrum-canvas');
    const ctx = canvas.getContext('2d');
    let simData = [];

    function randomizeData() {
        simData = [];
        for (let i = 0; i < 20; i++) {
            simData.push({
                x: Math.random() * canvas.width,
                y: Math.random() * canvas.height,
                intensity: Math.random()
            });
        }
        renderSimulation();
    }

    function renderSimulation() {
        const coldHex = document.getElementById('hex-cold').value;
        const hotHex = document.getElementById('hex-hot').value;

        // Clear
        ctx.fillStyle = "#000";
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // Draw Heatmap
        simData.forEach(point => {
            const color = interpolateColor(coldHex, hotHex, point.intensity);
            const gradient = ctx.createRadialGradient(point.x, point.y, 1, point.x, point.y, 40);
            gradient.addColorStop(0, color);
            gradient.addColorStop(1, 'transparent');

            ctx.fillStyle = gradient;
            ctx.globalAlpha = 0.6;
            ctx.beginPath();
            ctx.arc(point.x, point.y, 40, 0, Math.PI * 2);
            ctx.fill();
        });

        ctx.globalAlpha = 1.0;
    }

    function interpolateColor(c0, c1, f) {
        const r0 = parseInt(c0.slice(1, 3), 16);
        const g0 = parseInt(c0.slice(3, 5), 16);
        const b0 = parseInt(c0.slice(5, 7), 16);

        const r1 = parseInt(c1.slice(1, 3), 16);
        const g1 = parseInt(c1.slice(3, 5), 16);
        const b1 = parseInt(c1.slice(5, 7), 16);

        const r = Math.round(r0 + f * (r1 - r0)).toString(16).padStart(2, '0');
        const g = Math.round(g0 + f * (g1 - g0)).toString(16).padStart(2, '0');
        const b = Math.round(b0 + f * (b1 - b0)).toString(16).padStart(2, '0');

        return `#${r}${g}${b}`;
    }

    // Init
    randomizeData();
</script>